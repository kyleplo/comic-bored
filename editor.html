<!DOCTYPE html><html>
<head><title>ComicBored</title><link rel="stylesheet" href="./style.css"></head>
<body>
<div style="position:fixed;top:0px;left:0px;width:73%;height:177px;overflow-y:scroll;border-bottom:solid 1px black">
<div id="person" hidden>
<h3>Person</h3>
<p>Speech: <input type="text" id="speech" placeholder="What should I say?" onchange="comic[selected].caption = this.value"></p>
<p>Expression: <select id="expression" onchange="comic[selected].face = this.value"><option value="happy">happy :-)</option><option value="normal">normal :-|</option><option value="sad">sad :-(</option><option value="toothy">toothy smile :-D</option><option value="angry">angry #-(</option><option value="sleep">sleep ;-|</option></select></p>
</div>
<div id="obj" hidden>
<h3>Object</h3>
<p>There aren't any object properties... <i>(yet)</i></p>
</div>
<div id="bg" hidden>
<h3>Background</h3>
<p>Caption: <input type="text" id="caption" placeholder="What is going on?" onchange="comic[selected].caption = this.value"></p>
</div>
<div id="comic">
<h3>Comic</h3>
<p>Title: <input type="text" id="title" placeholder="Name your comic!!"></p>
<p>Width (in panels): <select id="width" onchange="document.getElementById('gridSvg').src = getGridSvg(parseFloat(this.value),parseFloat(document.getElementById('height').value))"><option value="2">2</option><option value="3">3</option><option value="4" selected>4</option><option value="5">5</option></select></p>
<p>Height (in panels): <select id="height" onchange="document.getElementById('gridSvg').src = getGridSvg(parseFloat(document.getElementById('width').value),parseFloat(this.value))"><option value="1">1</option><option value="2" selected>2</option><option value="3">3</option><option value="4">4</option></select></p>
</div>
</div>
<div style="position:fixed;top:0px;right:0px;width:25%;border-left:solid 1px black;height:99%;overflow-y:scroll">
<h3>My Assets</h3>
<a href="./create/person.html" target="addAsset" onclick="document.getElementById('add').removeAttribute('hidden')"><button>Create person</button></a>
<a href="./create/bg.html" target="addAsset" onclick="document.getElementById('add').removeAttribute('hidden')"><button>Create background</button></a>
<a href="./create/obj.html" target="addAsset" onclick="document.getElementById('add').removeAttribute('hidden')"><button>Add object</button></a>
<a href="./create/upload.html" target="addAsset" onclick="document.getElementById('add').removeAttribute('hidden')"><button>Upload asset</button></a>
  <button onclick="localStorage.assets = '';document.getElementById('assets').innerHTML = '';">Delete All Assets</button>
<div id="assets">
</div></div>
  <div id="editor" style="position:fixed;top:190px;left:0px;width:73%;height:calc(100% - 190px);overflow:scroll"><img onclick="chooseMenu('comic');selected = 'comic'" id="gridSvg" src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPScxLjEnIHdpZHRoPScxMjAwJyBoZWlnaHQ9JzYwMCcgeG1sbnM9J2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJyB4bWxuczp4bGluaz0naHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayc+PHJlY3Qgd2lkdGg9JzEyMDAnIGhlaWdodD0nNjAwJyBzdHJva2U9J2JsYWNrJyBzdHJva2Utd2lkdGg9JzQnIGZpbGw9J3doaXRlJyAvPjxsaW5lIHgxPSczMDAnIHkxPScwJyB4Mj0nMzAwJyB5Mj0nNjAwJyBzdHlsZT0nc3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDo0JyAvPjxsaW5lIHgxPSc2MDAnIHkxPScwJyB4Mj0nNjAwJyB5Mj0nNjAwJyBzdHlsZT0nc3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDo0JyAvPjxsaW5lIHgxPSc5MDAnIHkxPScwJyB4Mj0nOTAwJyB5Mj0nNjAwJyBzdHlsZT0nc3Ryb2tlOmJsYWNrO3N0cm9rZS13aWR0aDo0JyAvPjxsaW5lIHgxPScwJyB5MT0nMzAwJyB4Mj0nMTIwMCcgeTI9JzMwMCcgc3R5bGU9J3N0cm9rZTpibGFjaztzdHJva2Utd2lkdGg6NCcgLz48L3N2Zz4="></div>
<iframe id="add" name="addAsset" style="position:fixed;top:190px;left:0px;width:73%;height:calc(100% - 200px);border:none" hidden></iframe>
<script src="https://cdnjs.cloudflare.com/ajax/libs/interact.js/1.2.9/interact.min.js"></script>
<script>
var comic = [];
var selected = "comic";
window.addEventListener("load",function (){
if(localStorage.assets){
var assets = localStorage.assets.split("^");
for(var i = 0;i < assets.length;i++){
document.getElementById("assets").innerHTML += "<img src='" + assets[i].split("|")[1] + "' data-type='" + assets[i].split("|")[0] + "' data-face='" + assets[i].split("|")[2] + "'>";
document.getElementById("assets").children[document.getElementById("assets").children.length - 1].addEventListener("click",function (e){
document.getElementById("editor").innerHTML += "<img style='position:fixed;top:200px;left:0px' src='" + e.target.src + "' data-type='" + e.target.getAttribute('data-type') + "' data-face='" + e.target.getAttribute('data-face') + "' class='editImg' data-num='" + comic.length + "'>";
comic.push({x: 0,y: 0,src: assets[i].split("|")[1],type: assets[i].split("|")[0], face:assets[i].split("|")[2],caption: ""});
interact(document.getElementsByClassName('editImg')[document.getElementsByClassName("editImg").length - 1]).draggable({
onend: function (event){comic[event.target.getAttribute("data-num")].x = event.pageX;comic[event.target.getAttribute("data-num")].y = event.pageY;},
ontap: function (event){
chooseMenu(event.target.getAttribute("data-type"));
selected = event.target.getAttribute("data-num");
console.log("Item selected");
}  
});
});
};
}else{localStorage.assets = ""}
});
window.addEventListener("message",function (e){
document.getElementById('add').setAttribute("hidden","hidden");
document.getElementById("assets").innerHTML += "<img src='" + e.data.split("|")[1] + "' data-type='" + e.data.split("|")[0] + "' data-face='" + e.data.split("|")[2] + "'>";
if(localStorage.assets.length > 0){localStorage.assets += "^" + e.data}else{localStorage.assets += e.data};
});
function getGridSvg(w,h){
var svg = "<svg version='1.1' width='" + (w * 300) + "' height='" + (h * 300) + "' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>";
svg += "<rect width='" + (w * 300) + "' height='" + (h * 300) + "' stroke='black' stroke-width='4' fill='white' />";
for(var i = 0;i < (w - 1);i++){
svg += "<line x1='" + ((i + 1) * 300) + "' y1='0' x2='" + ((i + 1) * 300) + "' y2='" + (h * 300) + "' style='stroke:black;stroke-width:4' />";
};
for(var i = 0;i < (h - 1);i++){
svg += "<line x1='0' y1='" + ((i + 1) * 300) + "' x2='" + (w * 300) + "' y2='" + ((i + 1) * 300) + "' style='stroke:black;stroke-width:4' />";
};
svg += "</svg>";
return "data:image/svg+xml;base64," + btoa(svg);
}
function trimSvg(svg){return svg.slice((svg.indexOf("path") - 1),(svg.length - 6));}
function chooseMenu(menu){
document.getElementById('person').setAttribute("hidden","hidden");
document.getElementById('obj').setAttribute("hidden","hidden");
document.getElementById('bg').setAttribute("hidden","hidden");
document.getElementById('comic').setAttribute("hidden","hidden");
document.getElementById(menu).removeAttribute("hidden");
}

</script>
</body>
</html>
